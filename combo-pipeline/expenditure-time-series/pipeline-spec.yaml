expenditure-time-series:
  title: Expenditure Time Series
  description: Combined dataset which consists of ENE, AENE and ARE datasets of all financial years.
  pipeline:
  - run: load
    parameters:
      from: 'https://data.vulekamali.gov.za/dataset/3909f64d-b35d-4f71-af61-93148d943580/resource/977f2471-53ec-4643-b054-bb59a1eba511/download/are-2017-18.csv'
      name: 'are-2017-18'
      format: 'csv'
    cache: true
  - run: filter
    parameters:
      resources: are-2017-18
      in:
        - FinYear: '2017'
  - run: load
    parameters:
      from: 'https://data.vulekamali.gov.za/dataset/5acabeef-4140-4f74-8178-885186677fd3/resource/b2135502-a76e-4d24-bd88-7c5447834d1a/download/are-2016-17.csv'
      name: 'are-2016-17'
      format: 'csv'
    cache: true
  - run: filter
    parameters:
      resources: are-2016-17
      in:
        - FinYear: '2016'

  - run: load
    parameters:
      from: 'https://data.vulekamali.gov.za/dataset/e75e7fe3-e80d-421d-95ab-aefd3dbc7819/resource/f5561bdf-2528-4361-9669-32ab64e980ce/download/are-2015-16.csv'
      name: 'are-2015-16'
      format: 'csv'
    cache: true
  - run: filter
    parameters:
      resources: are-2015-16
      in:
        - FinYear: '2015'

#  - run: load
#    parameters:
#      from: 'https://data.vulekamali.gov.za/dataset/estimates-of-national-expenditure-2017-18/resource/3653542a-87f1-4089-9897-79a1b0392ebb'
#      name: 'ene-2017-18'
#      format: 'csv'
  - run: load
    parameters:
      from: 'https://data.vulekamali.gov.za/dataset/adjusted-estimates-of-national-expenditure-2017-18/resource/23275a9c-909d-454f-8c70-7e61205bb49d'
      name: 'aene-2017-18'
      format: 'csv'
  - run: add_computed_field
    parameters:
      resources: aene-2017-18
      fields:
        -
          target: Source
          operation: constant
          with: AENE
        -
          target: Government
          operation: constant
          with: South Africa


  - run: concatenate
    parameters:
      target:
        name: expenditure-time-series
        path: data/expenditure-time-series.csv
      fields:
        Budget Phase: ['budget phase', 'budget_phase']
        Department: ['department']
        Econ1: ['econ1']
        Econ2: ['econ2']
        Econ3: ['econ3']
        Econ4: ['econ4']
        Econ5: ['econ5']
        ProgNo: ['progno', 'Progno']
        Programme: ['programme']
        Government: ['Province', 'province', 'government']
        Source: ['source']
        SprogNo: ['sprogno', 'Sprogno']
        Subprogramme: ['subprogramme']
        VoteNo: ['voteno', 'Voteno']
        Amount Kind: ['amount kind', 'fy_descript']
        Value: ['value']
        FinYear: ['finyear']
    cache: false
  - run: dump_to_path
    parameters:
      out-path: './processed'
      format: 'csv'